<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Connecting to Google Cloud Platform Compute Engine</title>
  <meta name="description" content="Perpetually Under Construction...">
  <meta name="author" content="Brett Israelsen">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Brett Israelsen">
  <meta name="twitter:description" content="Perpetually Under Construction...">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Brett Israelsen">
  <meta property="og:description" content="Perpetually Under Construction...">

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://bisraelsen.github.io///2018/gcloud-config/">
  <link rel="alternate" type="application/rss+xml" title="Brett Israelsen" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(/images/mesh_surf_flipped_med.png)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home">
          <img src="/images/profile_light.png" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Brett Israelsen</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">Perpetually Under Construction...</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/bio" title="more about me" class="blog-button">Bio/CV</a></li>
            </ul>
          </nav>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/pubs/index.html" title="my publications" class="blog-button">Publications</a></li>
            </ul>
          </nav>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/code/index.html" title="my code" class="blog-button">Code</a></li>
            </ul>
          </nav>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/blog/index.html" title="link to my blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/contact" title="contact me" class="blog-button">Contact</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">

            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/BrettIsraelsen" title="@BrettIsraelsen on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/bisraelsen" title="bisraelsen on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/bisraelsen" title="bisraelsen on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:brett.israelsen@gmail.com" title="Email brett.israelsen@gmail.com" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>

            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="3 Mar 2018" class="post-meta__date date">3 Mar 2018</time> &#8226; <span class="post-meta__tags">on <a href="/tags/#Google cloud platform">Google cloud platform</a> <a href="/tags/#bread crumbs">bread crumbs</a> </span>
    </div>
    <h3 class="post-title">Connecting to Google Cloud Platform Compute Engine</h3>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript" async
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
    </script>
  </header>

  <section class="post">
    <p>I have recently began using Google Cloud Platform for my more demading computing needs. I have really liked it, and find it quite a bit easier to navigate than AWS. Anyway, connecting to the instance via the web browser is very nice, but it is also useful to be able to connect via ssh when I need to transfer files to/from my machine (I know there is a upload/download tool in the browser, but it is very cumbersome for operating on many files). Anyway, the answer to this is to connect directly to the instance via ssh, but there are a few steps to make this work.I</p>

<p>I am assuming you have already created an instance, and now just want to connect to the instance directly from your Ubuntu computer. I have also tried this from WSL (Windows subsystem for Linux), and I suppose it is fairly straight-forward for other linux distributions as well. Following the <code class="highlighter-rouge">Use another SSH client</code> dropdown link from the connect column in the <code class="highlighter-rouge">VM Instances</code> tab of the <code class="highlighter-rouge">Compute Engine</code> screen will point you in the right direction for what you need, but I found the documentation a little difficult to navigate.</p>

<ul>
  <li>
    <p>This <a href="https://cloud.google.com/sdk/docs/quickstart-debian-ubuntu">link</a> was especially for finding out how to install the Google Cloud SDK. Basically:</p>

    <ul>
      <li>
        <div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Create an environment variable for the correct distribution</span>
<span class="nb">export </span><span class="nv">CLOUD_SDK_REPO</span><span class="o">=</span><span class="s2">"cloud-sdk-</span><span class="k">$(</span>lsb_release -c -s<span class="k">)</span><span class="s2">"</span>
<span class="c"># Add the Cloud SDK distribution URI as a package source</span>
<span class="nb">echo</span> <span class="s2">"deb http://packages.cloud.google.com/apt </span><span class="nv">$CLOUD_SDK_REPO</span><span class="s2"> main"</span> | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
<span class="c"># Import the Google Cloud Platform public key</span>
curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
<span class="c"># Update the package list and install the Cloud SDK</span>
sudo apt-get update <span class="o">&amp;&amp;</span> sudo apt-get install google-cloud-sdk
</code></pre>
        </div>
      </li>
    </ul>
  </li>
  <li>Once that is done, then follow the instructions for initializing the SDK, which are lower on that same page.</li>
  <li>For some reason the VM that I created on GCP made a user name that was <code class="highlighter-rouge">firstname_lastname</code>, however when I try to connect using the default settings from the SDK it logs in to the VM using the user <code class="highlighter-rouge">firstname</code>. I found after some diffing that you can specify what user with the following command:
  <code class="highlighter-rouge">bash
  gcloud compute ssh [user name]@[instance name]
 </code></li>
  <li>auto mounting other volumes
    <ul>
      <li>add <code class="highlighter-rouge">/deb/sdb /home/user/mount_folder</code> to <code class="highlighter-rouge">/etc/fstab</code></li>
    </ul>
  </li>
  <li>Can upload/download files via:
    <ul>
      <li><a href="https://cloud.google.com/sdk/gcloud/reference/compute/scp">scp</a> <code class="highlighter-rouge">gcloud compute scp USER@instance:/file/to/copy /path/to/place/copy</code></li>
      <li><a href="https://cloud.google.com/storage/docs/gsutil/commands/rsync">rsync</a> <code class="highlighter-rouge">gsutil rsync FOLDER gs://example-bucket/DESTINATION</code></li>
      <li><a href="https://github.com/GoogleCloudPlatform/gcsfuse/blob/master/docs/mounting.md">mount bucket by hand</a> <code class="highlighter-rouge">gcsfuse example-bucket /path/to/mount/point</code>, and unmount via <code class="highlighter-rouge">fusermount -u /path/to/mount/point</code></li>
    </ul>
  </li>
</ul>

<hr />
<p>I spent quite a while figuring this out but I think this is a lost cause— it would have been nice</p>

<ul>
  <li>Connecting VM to a Cloud Storage Bucket. Use <a href="https://cloud.google.com/compute/docs/instances/transfer-files#gcstransfer">this link</a> and this <a href="https://cloud.google.com/storage/docs/gcs-fuse">link</a>
    <ul>
      <li>Need to set the <code class="highlighter-rouge">Storage</code> access to <code class="highlighter-rouge">Full</code> in the cloud API access scopes</li>
      <li>Now you can create a directory on your VM and then connect it to the storage bucket by
  <code class="highlighter-rouge">bash
  gcsfuse example-bucket /path/to/mount
 </code></li>
      <li>In order to mount the bucket automatically on startup I tried to use <a href="https://github.com/GoogleCloudPlatform/gcsfuse/blob/master/docs/mounting.md">this link</a>, <code class="highlighter-rouge">uid</code> and/or <code class="highlighter-rouge">gid</code> can be obtained by <code class="highlighter-rouge">id -u USER</code> and <code class="highlighter-rouge">id -g USER</code> respectively. <code class="highlighter-rouge">uid</code> and/or <code class="highlighter-rouge">gid</code> can be used (both don’t have to be used).
  <code class="highlighter-rouge">bash
  example-bucket /mount/point gcsfuse rw,uid=1001,gid=1001
 </code>
  This approach DID NOT work. I also tried adding a startup script, but it didn’t work either. It seems like the startup script is running with sudo permissions, which messes up <code class="highlighter-rouge">gcsfuse</code>. I found another thread [here][auto-mount] that gives another method
        <ul>
          <li>add <code class="highlighter-rouge">example-bucket /mount/point gcsfuse rw,noauto,user</code> to <code class="highlighter-rouge">/etc/fstab</code></li>
          <li>then add <code class="highlighter-rouge">mount example-bucket</code> to <code class="highlighter-rouge">/etc/rc.local</code></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


  </section>
  <section id="disqus_thread"></section><div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//bisraelsen-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>

    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://bisraelsen.github.io//2018/gcloud-config/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '/2018/gcloud-config'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };

      (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//@brettisraelsen.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
       })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2018 Brett Israelsen. All rights reserved.</span>
</footer> 

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45808513-2', 'auto');
  ga('send', 'pageview');
</script>

    </div>
  </body>
</html>